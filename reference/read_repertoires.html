<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Read and process immune repertoire files to immundata — read_repertoires • immundata</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Read and process immune repertoire files to immundata — read_repertoires"><meta property="og:description" content="This is the main function for reading immune repertoire data into the
immundata framework. It reads one or more repertoire files (AIRR TSV,
10X CSV, Parquet), performs optional preprocessing and column renaming,
aggregates sequences into receptors based on a provided schema, optionally
joins external metadata, performs optional postprocessing, and returns
an ImmunData object.
The function handles different data types (bulk, single-cell) based on
the presence of barcode_col and count_col. For efficiency with large
datasets, it processes the data and saves intermediate results (annotations)
as a Parquet file before loading them back into the final ImmunData object."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">immundata</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.3.9002</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://immunomind.com" class="external-link">ImmunoMind</a>
</li>
<li>
  <a href="https://github.com/immunomind/immunarch" class="external-link">
    <span class="fa fa-github"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Read and process immune repertoire files to immundata</h1>
    <small class="dont-index">Source: <a href="https://github.com/immunomind/immundata/blob/main/R/io_repertoires_read.R" class="external-link"><code>R/io_repertoires_read.R</code></a></small>
    <div class="hidden name"><code>read_repertoires.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This is the main function for reading immune repertoire data into the
<code>immundata</code> framework. It reads one or more repertoire files (AIRR TSV,
10X CSV, Parquet), performs optional preprocessing and column renaming,
aggregates sequences into receptors based on a provided schema, optionally
joins external metadata, performs optional postprocessing, and returns
an <code>ImmunData</code> object.</p>
<p>The function handles different data types (bulk, single-cell) based on
the presence of <code>barcode_col</code> and <code>count_col</code>. For efficiency with large
datasets, it processes the data and saves intermediate results (annotations)
as a Parquet file before loading them back into the final <code>ImmunData</code> object.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">read_repertoires</span><span class="op">(</span></span>
<span>  <span class="va">path</span>,</span>
<span>  <span class="va">schema</span>,</span>
<span>  metadata <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  barcode_col <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  count_col <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  locus_col <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  umi_col <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  preprocess <span class="op">=</span> <span class="fu"><a href="preprocess_postprocess.html">make_default_preprocessing</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  postprocess <span class="op">=</span> <span class="fu"><a href="preprocess_postprocess.html">make_default_postprocessing</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  rename_columns <span class="op">=</span> <span class="fu"><a href="imd_schema.html">imd_rename_cols</a></span><span class="op">(</span><span class="st">"10x"</span><span class="op">)</span>,</span>
<span>  enforce_schema <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  metadata_file_col <span class="op">=</span> <span class="st">"File"</span>,</span>
<span>  output_folder <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  repertoire_schema <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-path">path<a class="anchor" aria-label="anchor" href="#arg-path"></a></dt>
<dd><p>Character vector. Path(s) to input repertoire files (e.g.,
<code>"/path/to/data/*.tsv.gz"</code>). Supports glob patterns via <code><a href="https://rdrr.io/r/base/Sys.glob.html" class="external-link">Sys.glob()</a></code>.
Files can be Parquet, CSV, TSV, or gzipped versions thereof. All files
must be of the same type.
Alternatively, pass the special string <code>"&lt;metadata&gt;"</code> to read file paths
from the <code>metadata</code> table (see <code>metadata</code> and <code>metadata_file_col</code> params).</p></dd>


<dt id="arg-schema">schema<a class="anchor" aria-label="anchor" href="#arg-schema"></a></dt>
<dd><p>Defines how unique receptors are identified. Can be:</p><ul><li><p>A character vector of column names (e.g., <code>c("v_call", "j_call", "junction_aa")</code>).</p></li>
<li><p>A schema object created by <code><a href="make_receptor_schema.html">make_receptor_schema()</a></code>, allowing specification
of chains for pairing (e.g., <code>make_receptor_schema(features = c("v_call", "junction_aa"), chains = c("TRA", "TRB"))</code>).</p></li>
</ul></dd>


<dt id="arg-metadata">metadata<a class="anchor" aria-label="anchor" href="#arg-metadata"></a></dt>
<dd><p>Optional. A data frame containing
metadata to be joined with the repertoire data, read by
<code><a href="read_metadata.html">read_metadata()</a></code> function. If <code>path = "&lt;metadata&gt;"</code>, this table <em>must</em>
be provided and contain the file paths column specified by <code>metadata_file_col</code>.
Default: <code>NULL</code>.</p></dd>


<dt id="arg-barcode-col">barcode_col<a class="anchor" aria-label="anchor" href="#arg-barcode-col"></a></dt>
<dd><p>Character(1). Name of the column containing cell barcodes
or other unique cell/clone identifiers for single-cell data. Triggers
single-cell processing logic in <code><a href="agg_receptors.html">agg_receptors()</a></code>. Default: <code>NULL</code>.</p></dd>


<dt id="arg-count-col">count_col<a class="anchor" aria-label="anchor" href="#arg-count-col"></a></dt>
<dd><p>Character(1). Name of the column containing UMI counts or
frequency counts for bulk sequencing data. Triggers bulk processing logic
in <code><a href="agg_receptors.html">agg_receptors()</a></code>. Default: <code>NULL</code>. Cannot be specified if <code>barcode_col</code> is also
specified.</p></dd>


<dt id="arg-locus-col">locus_col<a class="anchor" aria-label="anchor" href="#arg-locus-col"></a></dt>
<dd><p>Character(1). Name of the column specifying the receptor chain
locus (e.g., "TRA", "TRB", "IGH", "IGK", "IGL"). Required if <code>schema</code>
specifies chains for pairing. Default: <code>NULL</code>.</p></dd>


<dt id="arg-umi-col">umi_col<a class="anchor" aria-label="anchor" href="#arg-umi-col"></a></dt>
<dd><p>Character(1). Name of the column containing UMI counts for
single-cell data. Used during paired-chain processing to select the most
abundant chain per barcode per locus. Default: <code>NULL</code>.</p></dd>


<dt id="arg-preprocess">preprocess<a class="anchor" aria-label="anchor" href="#arg-preprocess"></a></dt>
<dd><p>List. A named list of functions to apply sequentially to the
raw data <em>before</em> receptor aggregation. Each function should accept a
data frame (or duckplyr_df) as its first argument. See
<code><a href="preprocess_postprocess.html">make_default_preprocessing()</a></code> for examples.
Default: <code><a href="preprocess_postprocess.html">make_default_preprocessing()</a></code>. Set to <code>NULL</code> or <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code> to disable.</p></dd>


<dt id="arg-postprocess">postprocess<a class="anchor" aria-label="anchor" href="#arg-postprocess"></a></dt>
<dd><p>List. A named list of functions to apply sequentially to the
annotation data <em>after</em> receptor aggregation and metadata joining. Each
function should accept a data frame (or duckplyr_df) as its first argument.
See <code><a href="preprocess_postprocess.html">make_default_postprocessing()</a></code> for examples.
Default: <code><a href="preprocess_postprocess.html">make_default_postprocessing()</a></code>. Set to <code>NULL</code> or <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code> to disable.</p></dd>


<dt id="arg-rename-columns">rename_columns<a class="anchor" aria-label="anchor" href="#arg-rename-columns"></a></dt>
<dd><p>Named character vector. Optional mapping to rename columns
in the input files using <code><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">dplyr::rename()</a></code> syntax (e.g.,
<code>c(new_name = "old_name", barcode = "cell_id")</code>). Renaming happens <em>before</em>
preprocessing and schema application. See <code><a href="imd_schema.html">imd_rename_cols()</a></code> for presets.
Default: <code>imd_rename_cols("10x")</code>.</p></dd>


<dt id="arg-enforce-schema">enforce_schema<a class="anchor" aria-label="anchor" href="#arg-enforce-schema"></a></dt>
<dd><p>Logical(1). If <code>TRUE</code> (default), reading multiple files
requires them to have the exact same columns and types. If <code>FALSE</code>, columns
are unioned across files (potentially slower, requires more memory).
Default: <code>TRUE</code>.</p></dd>


<dt id="arg-metadata-file-col">metadata_file_col<a class="anchor" aria-label="anchor" href="#arg-metadata-file-col"></a></dt>
<dd><p>Character(1). The name of the column in the <code>metadata</code>
table that contains the full paths to the repertoire files. Only used when
<code>path = "&lt;metadata&gt;"</code>. Default: <code>"File"</code>.</p></dd>


<dt id="arg-output-folder">output_folder<a class="anchor" aria-label="anchor" href="#arg-output-folder"></a></dt>
<dd><p>Character(1). Path to a directory where intermediate
processed annotation data will be saved as <code>annotations.parquet</code> and
<code>metadata.json</code>. If <code>NULL</code> (default), a folder named
<code>immundata-&lt;basename_without_ext&gt;</code> is created in the same directory as the
first input file specified in <code>path</code>. The final <code>ImmunData</code> object reads
from these saved files. Default: <code>NULL</code>.</p></dd>


<dt id="arg-repertoire-schema">repertoire_schema<a class="anchor" aria-label="anchor" href="#arg-repertoire-schema"></a></dt>
<dd><p>Character vector or Function. Defines columns used to
group annotations into distinct repertoires (e.g., by sample or donor).
If provided, <code><a href="agg_repertoires.html">agg_repertoires()</a></code> is called after loading to add repertoire-level
summaries and metrics. Default: <code>NULL</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>An <code>ImmunData</code> object containing the processed receptor annotations.
If <code>repertoire_schema</code> was provided, the object will also contain repertoire
definitions and summaries calculated by <code><a href="agg_repertoires.html">agg_repertoires()</a></code>.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The function executes the following steps:</p><ol><li><p>Validates inputs.</p></li>
<li><p>Determines the list of input files based on <code>path</code> and <code>metadata</code>. Checks file extensions.</p></li>
<li><p>Reads data using <code>duckplyr</code> (<code>read_parquet_duckdb</code> or <code>read_csv_duckdb</code>). Handles <code>.gz</code>.</p></li>
<li><p>Applies column renaming if <code>rename_columns</code> is provided.</p></li>
<li><p>Applies preprocessing steps sequentially if <code>preprocess</code> is provided.</p></li>
<li><p>Aggregates sequences into receptors using <code><a href="agg_receptors.html">agg_receptors()</a></code>, based on <code>schema</code>, <code>barcode_col</code>, <code>count_col</code>, <code>locus_col</code>, and <code>umi_col</code>. This creates the core annotation table.</p></li>
<li><p>Joins the <code>metadata</code> table if provided.</p></li>
<li><p>Applies postprocessing steps sequentially if <code>postprocess</code> is provided.</p></li>
<li><p>Creates a temporary <code>ImmunData</code> object in memory.</p></li>
<li><p>Determines the <code>output_folder</code> path.</p></li>
<li><p>Saves the processed annotation table and metadata using <code><a href="write_immundata.html">write_immundata()</a></code> to the <code>output_folder</code>.</p></li>
<li><p>Loads the data back from the saved Parquet files using <code><a href="read_immundata.html">read_immundata()</a></code> to create the final <code>ImmunData</code> object. This ensures the returned object is backed by efficient storage.</p></li>
<li><p>If <code>repertoire_schema</code> is provided, calls <code><a href="agg_repertoires.html">agg_repertoires()</a></code> on the loaded object to define and summarize repertoires.</p></li>
<li><p>Returns the final <code>ImmunData</code> object.</p></li>
</ol></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><a href="ImmunData.html">ImmunData</a>, <code><a href="read_immundata.html">read_immundata()</a></code>, <code><a href="write_immundata.html">write_immundata()</a></code>, <code><a href="read_metadata.html">read_metadata()</a></code>,
<code><a href="agg_receptors.html">agg_receptors()</a></code>, <code><a href="agg_repertoires.html">agg_repertoires()</a></code>, <code><a href="make_receptor_schema.html">make_receptor_schema()</a></code>,
<code><a href="preprocess_postprocess.html">make_default_preprocessing()</a></code>, <code><a href="preprocess_postprocess.html">make_default_postprocessing()</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Example 1: single-chain, one file</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Read a single AIRR TSV file, defining receptors by V/J/CDR3_aa</span></span></span>
<span class="r-in"><span><span class="co"># Assume "my_sample.tsv" exists and follows AIRR format</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create a dummy file for illustration</span></span></span>
<span class="r-in"><span><span class="va">airr_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  sequence_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"seq"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  v_call <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TRBV1"</span>, <span class="st">"TRBV1"</span>, <span class="st">"TRBV2"</span>, <span class="st">"TRBV1"</span>, <span class="st">"TRBV3"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  j_call <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TRBJ1"</span>, <span class="st">"TRBJ1"</span>, <span class="st">"TRBJ2"</span>, <span class="st">"TRBJ1"</span>, <span class="st">"TRBJ1"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  junction_aa <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CASSL..."</span>, <span class="st">"CASSL..."</span>, <span class="st">"CASSD..."</span>, <span class="st">"CASSL..."</span>, <span class="st">"CASSF..."</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  productive <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  locus <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TRB"</span>, <span class="st">"TRB"</span>, <span class="st">"TRB"</span>, <span class="st">"TRB"</span>, <span class="st">"TRB"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_tsv</a></span><span class="op">(</span><span class="va">airr_data</span>, <span class="st">"my_sample.tsv"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Define receptor schema</span></span></span>
<span class="r-in"><span><span class="va">receptor_def</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"v_call"</span>, <span class="st">"j_call"</span>, <span class="st">"junction_aa"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Specify output folder</span></span></span>
<span class="r-in"><span><span class="va">out_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="st">"immundata_output_"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Read the data (disabling default preprocessing for this simple example)</span></span></span>
<span class="r-in"><span><span class="va">idata</span> <span class="op">&lt;-</span> <span class="fu">read_repertoires</span><span class="op">(</span></span></span>
<span class="r-in"><span>  path <span class="op">=</span> <span class="st">"my_sample.tsv"</span>,</span></span>
<span class="r-in"><span>  schema <span class="op">=</span> <span class="va">receptor_def</span>,</span></span>
<span class="r-in"><span>  output_folder <span class="op">=</span> <span class="va">out_dir</span>,</span></span>
<span class="r-in"><span>  preprocess <span class="op">=</span> <span class="cn">NULL</span>, <span class="co"># Disable default productive filter for demo</span></span></span>
<span class="r-in"><span>  postprocess <span class="op">=</span> <span class="cn">NULL</span> <span class="co"># Disable default barcode prefixing</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">idata</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">idata</span><span class="op">$</span><span class="va">annotations</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Example 2: single-chain, multiple files</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># Read multiple files using metadata</span></span></span>
<span class="r-in"><span><span class="co"># Create dummy files and metadata</span></span></span>
<span class="r-in"><span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_tsv</a></span><span class="op">(</span><span class="va">airr_data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="op">]</span>, <span class="st">"sample1.tsv"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_tsv</a></span><span class="op">(</span><span class="va">airr_data</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span>, <span class="st">"sample2.tsv"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  SampleID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S1"</span>, <span class="st">"S2"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  Tissue <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PBMC"</span>, <span class="st">"Tumor"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  FilePath <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/normalizePath.html" class="external-link">normalizePath</a></span><span class="op">(</span><span class="st">"sample1.tsv"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/normalizePath.html" class="external-link">normalizePath</a></span><span class="op">(</span><span class="st">"sample2.tsv"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_tsv</a></span><span class="op">(</span><span class="va">meta</span>, <span class="st">"metadata.tsv"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">idata_multi</span> <span class="op">&lt;-</span> <span class="fu">read_repertoires</span><span class="op">(</span></span></span>
<span class="r-in"><span>  path <span class="op">=</span> <span class="st">"&lt;metadata&gt;"</span>,</span></span>
<span class="r-in"><span>  metadata <span class="op">=</span> <span class="va">meta</span>,</span></span>
<span class="r-in"><span>  metadata_file_col <span class="op">=</span> <span class="st">"FilePath"</span>,</span></span>
<span class="r-in"><span>  schema <span class="op">=</span> <span class="va">receptor_def</span>,</span></span>
<span class="r-in"><span>  repertoire_schema <span class="op">=</span> <span class="st">"SampleID"</span>, <span class="co"># Aggregate by SampleID</span></span></span>
<span class="r-in"><span>  output_folder <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="st">"immundata_multi_"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  preprocess <span class="op">=</span> <span class="fu"><a href="preprocess_postprocess.html">make_default_preprocessing</a></span><span class="op">(</span><span class="st">"airr"</span><span class="op">)</span>, <span class="co"># Use default AIRR filters</span></span></span>
<span class="r-in"><span>  postprocess <span class="op">=</span> <span class="cn">NULL</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">idata_multi</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">idata_multi</span><span class="op">$</span><span class="va">repertoires</span><span class="op">)</span> <span class="co"># Check repertoire summary</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Clean up dummy files</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove</a></span><span class="op">(</span><span class="st">"my_sample.tsv"</span>, <span class="st">"sample1.tsv"</span>, <span class="st">"sample2.tsv"</span>, <span class="st">"metadata.tsv"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">out_dir</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">idata_multi</span>, <span class="st">"output_folder"</span><span class="op">)</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># Get path used by function</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://www.linkedin.com/in/vdnaz" class="external-link">Vadim I. Nazarov</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

      </footer></div>






  </body></html>

